<!DOCTYPE html>
<html>
<head>
    <title>LINE LIFF</title>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        #qrcode {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        form {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        input {
            margin: 10px;
            padding: 8px;
            font-size: 16px;
        }
    </style>    
</head>

<body>
    <div id="qrcode">
        <form id="userForm">
            <input type="email" id="email" placeholder="メールアドレス" required>
            <input type="tel" id="phone" placeholder="電話番号" required>
            <button type="submit">送信</button>
        </form>
    </div>

    <script>
        let userId = '';

        async function main() {
            await liff.init({ liffId: "2001381147-OALZKQMg" });

            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                const profile = await liff.getProfile();
                userId = profile.userId; // userIdを取得して保持する
            }
        }

        // フォームの送信処理
        document.getElementById('userForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;

            if (userId) {
                await submitForm(userId, email, phone);
            } else {
                alert("User IDが取得できませんでした。");
            }
        });

        // データをスプレッドシートに送信する関数
        async function submitForm(userId, email, phone) {
            const scriptURL = 'https://script.google.com/macros/s/AKfycbxT2i0EQ0MQEqK18QkFssieaNEiJCGZCFsAtFM-xVUMg83NQSGE91x-GyYXer2fuy5Z/exec';
            const data = { userId, email, phone };

            try {
                const response = await fetch(scriptURL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                alert('送信完了しました！');
            } catch (error) {
                console.error('Error!', error);
                alert('送信中にエラーが発生しました。');
            }
        }

        main();
    </script>

</body>
</html>
